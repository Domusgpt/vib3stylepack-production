<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperAV - 4D Visualizer</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            background-color: #0d0d1a; /* Dark blue-ish background */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #main-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        #hypercube-canvas {
            flex-grow: 1;
            height: 100%;
            display: block;
        }

        #hyperAVDashboardContainer {
            width: 350px;
            flex-shrink: 0;
            height: 100vh; /* Full viewport height */
            background-color: #1a1a2e; /* Slightly lighter dashboard background */
            color: #e0e0e0;
            box-shadow: -5px 0px 15px rgba(0,0,0,0.5);
            overflow-y: auto;
            padding: 15px;
            box-sizing: border-box;
            z-index: 10;
        }
        
        /* Basic styling for dashboard elements (can be expanded in DashboardUIManager) */
        .dashboard-section { margin-bottom: 20px; }
        .dashboard-section h3 { 
            margin: 0 0 10px 0; 
            padding-bottom: 5px;
            border-bottom: 1px solid #4f4f7a;
            color: #a0a0ff;
            font-size: 1em;
        }
        .dashboard-control { margin-bottom: 10px; }
        .dashboard-control label { display: block; margin-bottom: 5px; font-size: 0.9em; }
        .dashboard-control select, .dashboard-control input[type="range"] {
            width: 100%;
            padding: 5px;
            background-color: #2a2a4e;
            border: 1px solid #4f4f7a;
            color: #e0e0e0;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div id="main-container">
        <canvas id="hypercube-canvas"></canvas>
        <div id="hyperAVDashboardContainer">
            </div>
    </div>

    <script src="js/gl-matrix.js"></script> 

    <script src="js/core/BaseGeometry.js"></script>
    <script src="js/core/BaseProjection.js"></script>
    <script src="js/managers/ShaderManager.js"></script>
    <script src="js/managers/GeometryManager.js"></script>
    <script src="js/managers/ProjectionManager.js"></script>
    <script src="js/ui/DashboardUIManager.js"></script>
    <script src="js/bridge/VIB3HomeMasterBridge.js"></script>

    <script src="js/geometries/HypercubeGeometry.js"></script>
    <script src="js/geometries/HypersphereGeometry.js"></script>
    <script src="js/geometries/HypertetrahedronGeometry.js"></script>
    <script src="js/geometries/TorusGeometry.js"></script>
    <script src="js/geometries/KleinBottleGeometry.js"></script>
    <script src="js/geometries/FractalGeometry.js"></script>
    <script src="js/geometries/WaveGeometry.js"></script>
    <script src="js/geometries/CrystalGeometry.js"></script>

    <script src="js/projections/PerspectiveProjection.js"></script>
    <script src="js/projections/OrthographicProjection.js"></script>
    <script src="js/projections/StereographicProjection.js"></script>

    <script src="js/core/HypercubeCore.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Initialize the core application. 
                // All other managers and UI are now instantiated inside HypercubeCore's constructor.
                const hypercubeCore = new HypercubeCore('hypercube-canvas');
                
                // Make core instance globally accessible for debugging if needed
                window.hypercubeCore = hypercubeCore;

                // The VIB3HomeMasterBridge connects to an external system, so it's initialized here.
                const homeMasterBridge = new VIB3HomeMasterBridge(hypercubeCore);
                homeMasterBridge.connect();

            } catch (error) {
                console.error("Failed to initialize HypercubeCore:", error);
                document.getElementById('main-container').innerHTML = 
                    `<div style="padding: 20px; color: red;">
                        <h2>Fatal Error</h2>
                        <p>Could not initialize the HyperAV visualizer.</p>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Please check the developer console for more details.</p>
                    </div>`;
            }
        });
    </script>

</body>
</html>