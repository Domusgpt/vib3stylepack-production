<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIB34D Dashboard Functional Test</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #000; color: #0f0; padding: 20px; }
        .test-result { padding: 10px; margin: 5px 0; border-left: 3px solid; }
        .pass { border-color: #0f0; background: rgba(0, 255, 0, 0.1); }
        .fail { border-color: #f00; background: rgba(255, 0, 0, 0.1); }
        .warning { border-color: #ff0; background: rgba(255, 255, 0, 0.1); }
        .info { border-color: #0ff; background: rgba(0, 255, 255, 0.1); }
        iframe { width: 100%; height: 600px; border: 2px solid #0ff; margin: 20px 0; }
        button { background: #333; color: #0f0; border: 1px solid #0f0; padding: 10px; margin: 5px; cursor: pointer; }
        button:hover { background: #0f0; color: #000; }
        #testResults { max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üß™ VIB34D Dashboard Functional Test Suite</h1>
    
    <div class="test-result info">
        <strong>Testing:</strong> https://domusgpt.github.io/vib3stylepack-production/VIB34D_EDITOR_DASHBOARD.html
    </div>
    
    <button onclick="runAllTests()">üöÄ Run All Tests</button>
    <button onclick="testBasicLoad()">üìÑ Test Basic Load</button>
    <button onclick="testInteractivity()">üñ±Ô∏è Test Interactivity</button>
    <button onclick="testDragDrop()">üì¶ Test Drag & Drop</button>
    <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
    
    <div id="testResults"></div>
    
    <!-- Dashboard iframe for testing -->
    <iframe id="dashboardFrame" src="https://domusgpt.github.io/vib3stylepack-production/VIB34D_EDITOR_DASHBOARD.html"></iframe>
    
    <script>
        const results = document.getElementById('testResults');
        let testCount = 0;
        
        function log(message, type = 'info') {
            testCount++;
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>[${testCount}]</strong> ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearResults() {
            results.innerHTML = '';
            testCount = 0;
        }
        
        async function runAllTests() {
            clearResults();
            log('üß™ Starting comprehensive VIB34D Dashboard test suite...', 'info');
            
            await testBasicLoad();
            await testInteractivity();
            await testDragDrop();
            await testGeometryRendering();
            await testPropertyControls();
            await testExportFunctionality();
            
            log('‚úÖ Test suite completed!', 'pass');
        }
        
        async function testBasicLoad() {
            log('üìÑ Testing basic dashboard loading...', 'info');
            
            try {
                const iframe = document.getElementById('dashboardFrame');
                
                // Wait for iframe to load
                await new Promise((resolve) => {
                    iframe.onload = resolve;
                    setTimeout(resolve, 5000); // Timeout after 5 seconds
                });
                
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Test 1: Check if main elements exist
                const elementLibrary = iframeDoc.querySelector('.element-library');
                const canvasWorkspace = iframeDoc.querySelector('.canvas-workspace');
                const propertiesPanel = iframeDoc.querySelector('.properties-panel');
                
                if (elementLibrary) {
                    log('‚úÖ Element library panel found', 'pass');
                } else {
                    log('‚ùå Element library panel missing', 'fail');
                }
                
                if (canvasWorkspace) {
                    log('‚úÖ Canvas workspace found', 'pass');
                } else {
                    log('‚ùå Canvas workspace missing', 'fail');
                }
                
                if (propertiesPanel) {
                    log('‚úÖ Properties panel found', 'pass');
                } else {
                    log('‚ùå Properties panel missing', 'fail');
                }
                
                // Test 2: Check for geometry items
                const geometryItems = iframeDoc.querySelectorAll('.geometry-item');
                log(`‚úÖ Found ${geometryItems.length} geometry items`, geometryItems.length >= 8 ? 'pass' : 'warning');
                
                // Test 3: Check if JavaScript loaded
                const iframeWindow = iframe.contentWindow;
                if (typeof iframeWindow.VIB34DEditorDashboard !== 'undefined') {
                    log('‚úÖ VIB34DEditorDashboard class loaded', 'pass');
                } else {
                    log('‚ùå VIB34DEditorDashboard class not loaded', 'fail');
                }
                
                if (typeof iframeWindow.HypercubeCore !== 'undefined') {
                    log('‚úÖ HypercubeCore class loaded', 'pass');
                } else {
                    log('‚ùå HypercubeCore class not loaded', 'fail');
                }
                
                // Test 4: Check if gl-matrix loaded
                if (typeof iframeWindow.mat4 !== 'undefined') {
                    log('‚úÖ gl-matrix library loaded', 'pass');
                } else {
                    log('‚ùå gl-matrix library not loaded', 'fail');
                }
                
                // Test 5: Check if dashboard instance exists
                if (typeof iframeWindow.editorDashboard !== 'undefined') {
                    log('‚úÖ Editor dashboard instance created', 'pass');
                } else {
                    log('‚ùå Editor dashboard instance not created', 'fail');
                }
                
            } catch (error) {
                log(`‚ùå Basic load test failed: ${error.message}`, 'fail');
            }
        }
        
        async function testInteractivity() {
            log('üñ±Ô∏è Testing dashboard interactivity...', 'info');
            
            try {
                const iframe = document.getElementById('dashboardFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const iframeWindow = iframe.contentWindow;
                
                // Test toolbar buttons
                const toolbarButtons = iframeDoc.querySelectorAll('.toolbar-button');
                log(`‚úÖ Found ${toolbarButtons.length} toolbar buttons`, toolbarButtons.length >= 4 ? 'pass' : 'warning');
                
                // Test property sliders
                const propertySliders = iframeDoc.querySelectorAll('.property-slider');
                log(`‚úÖ Found ${propertySliders.length} property sliders`, propertySliders.length >= 4 ? 'pass' : 'warning');
                
                // Test global parameter functions
                if (typeof iframeWindow.updateGlobalParameter === 'function') {
                    log('‚úÖ updateGlobalParameter function exists', 'pass');
                } else {
                    log('‚ùå updateGlobalParameter function missing', 'fail');
                }
                
                // Test clear canvas function
                if (typeof iframeWindow.clearCanvas === 'function') {
                    log('‚úÖ clearCanvas function exists', 'pass');
                } else {
                    log('‚ùå clearCanvas function missing', 'fail');
                }
                
                // Test export function
                if (typeof iframeWindow.exportHTML === 'function') {
                    log('‚úÖ exportHTML function exists', 'pass');
                } else {
                    log('‚ùå exportHTML function missing', 'fail');
                }
                
            } catch (error) {
                log(`‚ùå Interactivity test failed: ${error.message}`, 'fail');
            }
        }
        
        async function testDragDrop() {
            log('üì¶ Testing drag-and-drop functionality...', 'info');
            
            try {
                const iframe = document.getElementById('dashboardFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const iframeWindow = iframe.contentWindow;
                
                // Check if geometry items are draggable
                const geometryItems = iframeDoc.querySelectorAll('.geometry-item[draggable="true"]');
                log(`‚úÖ Found ${geometryItems.length} draggable geometry items`, geometryItems.length >= 8 ? 'pass' : 'warning');
                
                // Check if canvas workspace accepts drops
                const canvasWorkspace = iframeDoc.querySelector('.canvas-workspace');
                if (canvasWorkspace) {
                    log('‚úÖ Canvas workspace ready for drops', 'pass');
                } else {
                    log('‚ùå Canvas workspace not found', 'fail');
                }
                
                // Test if dashboard has drag handlers
                if (iframeWindow.editorDashboard && typeof iframeWindow.editorDashboard.createElement === 'function') {
                    log('‚úÖ createElement function available for drops', 'pass');
                } else {
                    log('‚ùå createElement function not available', 'fail');
                }
                
                // Simulate a drop test
                try {
                    if (iframeWindow.editorDashboard) {
                        const mockItemData = {
                            geometry: 'hypercube',
                            type: 'hypercube'
                        };
                        
                        // Try to create an element
                        const initialCount = iframeWindow.editorDashboard.elements.size;
                        log(`üìä Initial element count: ${initialCount}`, 'info');
                        
                        // This would normally be triggered by a drop event
                        log('‚ö†Ô∏è Drop simulation requires actual user interaction', 'warning');
                    }
                } catch (error) {
                    log(`‚ö†Ô∏è Drop simulation error: ${error.message}`, 'warning');
                }
                
            } catch (error) {
                log(`‚ùå Drag-drop test failed: ${error.message}`, 'fail');
            }
        }
        
        async function testGeometryRendering() {
            log('üîÆ Testing 4D geometry rendering...', 'info');
            
            try {
                const iframe = document.getElementById('dashboardFrame');
                const iframeWindow = iframe.contentWindow;
                
                // Check if HypercubeCore can be instantiated
                if (typeof iframeWindow.HypercubeCore !== 'undefined') {
                    log('‚úÖ HypercubeCore class available', 'pass');
                    
                    // Test canvas creation
                    const testCanvas = iframeWindow.document.createElement('canvas');
                    testCanvas.width = 200;
                    testCanvas.height = 150;
                    
                    try {
                        const core = new iframeWindow.HypercubeCore(testCanvas);
                        log('‚úÖ HypercubeCore instance created successfully', 'pass');
                        
                        // Test geometry setting
                        if (typeof core.setGeometry === 'function') {
                            log('‚úÖ setGeometry method available', 'pass');
                        } else {
                            log('‚ùå setGeometry method missing', 'fail');
                        }
                        
                        // Test projection setting
                        if (typeof core.setProjection === 'function') {
                            log('‚úÖ setProjection method available', 'pass');
                        } else {
                            log('‚ùå setProjection method missing', 'fail');
                        }
                        
                        // Clean up
                        if (typeof core.destroy === 'function') {
                            core.destroy();
                        }
                        
                    } catch (coreError) {
                        log(`‚ö†Ô∏è HypercubeCore instantiation issue: ${coreError.message}`, 'warning');
                    }
                    
                } else {
                    log('‚ùå HypercubeCore class not available', 'fail');
                }
                
            } catch (error) {
                log(`‚ùå Geometry rendering test failed: ${error.message}`, 'fail');
            }
        }
        
        async function testPropertyControls() {
            log('üéõÔ∏è Testing property controls...', 'info');
            
            try {
                const iframe = document.getElementById('dashboardFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const iframeWindow = iframe.contentWindow;
                
                // Test global parameter sliders
                const intensitySlider = iframeDoc.querySelector('input[onchange*="intensity"]');
                const speedSlider = iframeDoc.querySelector('input[onchange*="speed"]');
                const densitySlider = iframeDoc.querySelector('input[onchange*="density"]');
                const saturationSlider = iframeDoc.querySelector('input[onchange*="saturation"]');
                
                if (intensitySlider) log('‚úÖ Intensity slider found', 'pass');
                else log('‚ùå Intensity slider missing', 'fail');
                
                if (speedSlider) log('‚úÖ Speed slider found', 'pass');
                else log('‚ùå Speed slider missing', 'fail');
                
                if (densitySlider) log('‚úÖ Density slider found', 'pass');
                else log('‚ùå Density slider missing', 'fail');
                
                if (saturationSlider) log('‚úÖ Saturation slider found', 'pass');
                else log('‚ùå Saturation slider missing', 'fail');
                
                // Test value display elements
                const valueDisplays = iframeDoc.querySelectorAll('span[id$="Value"]');
                log(`‚úÖ Found ${valueDisplays.length} parameter value displays`, valueDisplays.length >= 4 ? 'pass' : 'warning');
                
            } catch (error) {
                log(`‚ùå Property controls test failed: ${error.message}`, 'fail');
            }
        }
        
        async function testExportFunctionality() {
            log('üì§ Testing export functionality...', 'info');
            
            try {
                const iframe = document.getElementById('dashboardFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const iframeWindow = iframe.contentWindow;
                
                // Check for export modal
                const exportModal = iframeDoc.querySelector('#exportModal');
                if (exportModal) {
                    log('‚úÖ Export modal found', 'pass');
                } else {
                    log('‚ùå Export modal missing', 'fail');
                }
                
                // Check for export functions
                if (typeof iframeWindow.exportHTML === 'function') {
                    log('‚úÖ exportHTML function exists', 'pass');
                } else {
                    log('‚ùå exportHTML function missing', 'fail');
                }
                
                if (typeof iframeWindow.copyToClipboard === 'function') {
                    log('‚úÖ copyToClipboard function exists', 'pass');
                } else {
                    log('‚ùå copyToClipboard function missing', 'fail');
                }
                
                if (typeof iframeWindow.downloadHTML === 'function') {
                    log('‚úÖ downloadHTML function exists', 'pass');
                } else {
                    log('‚ùå downloadHTML function missing', 'fail');
                }
                
                // Test save/load functions
                if (typeof iframeWindow.saveProject === 'function') {
                    log('‚úÖ saveProject function exists', 'pass');
                } else {
                    log('‚ùå saveProject function missing', 'fail');
                }
                
                if (typeof iframeWindow.loadProject === 'function') {
                    log('‚úÖ loadProject function exists', 'pass');
                } else {
                    log('‚ùå loadProject function missing', 'fail');
                }
                
            } catch (error) {
                log(`‚ùå Export functionality test failed: ${error.message}`, 'fail');
            }
        }
        
        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üöÄ Auto-running test suite...', 'info');
                runAllTests();
            }, 2000);
        });
        
        // Monitor iframe for console errors
        document.getElementById('dashboardFrame').onload = function() {
            try {
                const iframeWindow = this.contentWindow;
                const originalError = iframeWindow.console.error;
                const originalWarn = iframeWindow.console.warn;
                
                iframeWindow.console.error = function(...args) {
                    log(`üö´ Dashboard Error: ${args.join(' ')}`, 'fail');
                    originalError.apply(this, args);
                };
                
                iframeWindow.console.warn = function(...args) {
                    log(`‚ö†Ô∏è Dashboard Warning: ${args.join(' ')}`, 'warning');
                    originalWarn.apply(this, args);
                };
                
                log('üì° Console monitoring active', 'info');
                
            } catch (e) {
                log('‚ö†Ô∏è Cannot monitor iframe console (CORS restrictions)', 'warning');
            }
        };
    </script>
</body>
</html>